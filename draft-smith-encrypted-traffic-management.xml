<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.25 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>

<rfc ipr="trust200902" docName="draft-smith-encrypted-traffic-management-01" category="info">

  <front>
    <title abbrev="encrypted-traffic-management">Network management of encrypted traffic</title>

    <author initials="K." surname="Smith" fullname="Kevin Smith">
      <organization>Vodafone Group</organization>
      <address>
        <email>kevin.smith@vodafone.com</email>
      </address>
    </author>

    <date year="2015" month="June" day="05"/>

    <area>Security</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>Encrypted Internet traffic may pose traffic management challenges to network operators. This document recommends approaches to help manage encrypted traffic, without breaching user privacy or security.</t>



    </abstract>


  </front>

  <middle>


<section anchor="intro" title="Introduction">
<t>Networks utilise various management techniques to ensure efficient throughput, congestion management, anti-SPAM and security measures. Historically these functions have utilised visibility of the Internet application layer.</t>

<t>This visibility is rapidly diminishing - encrypted Internet traffic is expected to continue its upward trend, driven by increased privacy
awareness, uptake by popular services, and advocacy from the <xref target="IAB"/>,  <xref target="RFC7258"/> and W3C <xref target="TAG"/> .</t>

<t><xref target="IAB"/>, <xref target="RFC7258"/> and <xref target="mm-effect-encrypt"/> recognise that network management functions are impacted by encryption, and that solutions are needed to persist them - as long as they do not threaten privacy. These solutions would ensure the benefits of encryption do not degrade network efficiency.</t>

<t>This document lists such solutions, and points to evolving IETF work addressing the problem.</t>

<section anchor="struc" title="Document structure">
<t>This document describes the network management functions that are likely to be hindered by traffic encryption.</t>

<t>It then describes the technical details of existing options to fully or partially persist these functions
under encryption. ‘Encryption’ in this document typically refers to HTTP over TLS <xref target="RFC2818"/>; other forms of encryption are noted where applicable.</t>

<t>Finally, a summary is provided of ongoing IETF work which is investigating how middleboxes along the network path can improve encrypted traffic delivery - again without breaching user privacy or security.</t>

<t>The legal, political and commercial aspects of network management are recgnised but not covered in this technical document.</t>

</section>
<section anchor="encryp" title="Security protocols">

<t>The following IETF protocols are considered in this document: TLS <xref target="RFC5246"/> , IPsec <xref target="RFC4301"/> and the ongoing transport layer security work of <xref target="TCPINC"/>.</t>

</section>
</section>
<section anchor="netman" title="Network management functions">

<t>Editor’s note: Part or all of this section may be removed where there is duplication with any updated version of <xref target="mm-effect-encrypt"/></t>

<section anchor="qu" title="Queuing">

<t>Traffic flowing through a network may be queued for delivery. This is important at an access network where network conditions can change rapidly - such as a cellular radio access network. To account for congestion, the network will categorise content requests  according to the latency and bandwidth required to deliver that content type. These combinations run from high-latency, low bandwidth (Email), medium latency, medium bandwidth (Web pages), low latency high bandwidth (video streaming), and many others including voice calls, texts, WebRTC and VoIP. A well-managed network will triage between these content types and deliver from each queue in bursts, to ensure no user experiences a disrupted service.</t>

</section>

<section anchor="lb" title="Server load balancing">

<t>Where network load balancers have been configured to route according to application-layer semantics, an encrypted payload is effectively invisible.This has resulted in practices of intercepting TLS in front of load balancers to regain that visibility, but at a cost to security and privacy.</t>

</section>

<section anchor="id" title="Intrusion detection">
<t>Networks will monitor traffic stream behaviours to identify likely Denial of Service attacks. Tools exist at each network layer to detect and mitigate these, including application layer detection.</t>

</section>
<section anchor="pe" title="Policy enforcement">
<t>Approved access to a network is a prerequisite to requests for Internet traffic - hence network access, including any authentication and authorisation, is not impacted by traffic encryption.</t>

<t>Cellular networks often sell tariffs that allow free-data access to certain sites, known as ‘zero rating’. A session to visit such a site incurs no additional cost or data usage to the user. Such ‘zero rating</t>

<t>Note: this section deliberately does not go into detail on the ramifications of encryption as regards government regulation. These regulations include ‘Lawful Intercept’, adherence to Codes of Practice on content filtering, application of court order filters. However it is clear that these functions are impacted by encryption, typically by allowing a less granular means of implementation. The enforcement of any Net Neutrality regulations is unlikely to be affected by content being encrypted.</t>

</section>
<section anchor="spam" title="SPAM and malware filtering">
<t>This has typically required Deep Packet Inspection to filter various keywords, fraudulent headers and virus attachments.</t>

</section>
</section>
<section anchor="flow" title="Flow information visible to a network">

<section anchor="ip5" title="IP 5-tuple">

<t>This indicates source and destination IP addresses/ports and the transport protocol. This information 
is available during TLS, TCP-layer encryption (except ports), and IP-layer encryption (IPSec); although it may be
obscured in Tunnel mode IPSec.</t>

<t>This allows network management at a coarse IP-source level, which makes it of limited value where the
origin server supports a blend of service types.</t>

<t>Obscured from network by: IPSec Tunnel Mode</t>

</section>
<section anchor="sni" title="TLS Server Name Indication">

<t>When initiating the TLS handshake, the Client may provide an extension field (server_name)
which indicates the server to which it is attempting a secure connection.
TLS SNI was standardized in 2003 to enable servers to present the “correct TLS certificate”
to clients in a deployment of multiple virtual servers hosted by the same server infrastructure
and IP-address. Although this is an optional extension, it is today supported by all modern
browsers, web servers and developer libraries. Notable exceptions are Android 2.2 and
Internet Explorer 6 on Windows XP.
It should be noted that HTTP/2 introduces the Alt-SVC method for upgrading the connection
from HTTP/1 to either unencrypted or encrypted HTTP/2. If the initial HTTP/1 request is
unencrypted, the destination alternate service name can be identified before the
communication is potentially upgraded to encrypted HTTP/2 transport.
HTTP/2 implementations MUST support the Server Name Indication (SNI) extension.</t>

<t>Limitation: This information is only visible if the client is populating the Server Name
Indication extension. This need not be done, but may be done as per TLS standard.
Therefore, even if existing network filters look out for seeing a Server Name Indication
extension, they may not find one. The per-domain nature of SNI may not reveal the specific
service or media type being accessed, especially where the domain is of a provider offering
a range of email, video, Web pages etc. For example, certain blog or social network feeds may
be deemed ‘adult content’, but the Server Name Indication will only indicate the server
domain rather than a URL path to be blocked.</t>

<t>Obscured from network by: not providing the SNI, IPSec</t>

</section>
<section anchor="alpn" title="Application Layer Protocol Negotiation (ALPN)">

<t>ALPN is a TLS extension which may be used to indicate the application protocol within the TLS 
session. This is likely to be of more value to the network where it indicates a protocol dedicated 
to a particular traffic type (such as video streaming) rather than a multi-use protocol.
ALPN is used as part of HTTP/2 ‘h2’, but will not indicate the traffic types which may make up
streams within an HTTP/2 multiplex.</t>

</section>
</section>
<section anchor="inflow" title="Inferred flow information">

<section anchor="heur" title="Heuristics">

<t>Heuristics can be used to map given input data to particular conclusions via some heuristic
reasoning. Examples of input data to this reasoning include IP destination address, TCP destination port, 
server name from SNI, typical traffic pattern (e.g. occurrence of IP packets and TCP segments over time).
The accuracy of heuristics depends on whether the observed traffic originates from a source 
delivering a single service, or a blend of services. In
many scenarios, this makes it possible to directly classify the traffic related to a specific
server/service even when the traffic is fully encrypted.</t>

<t>If the server/service is co-located on an infrastructure with other services that shares the
same IP-address, the encrypted traffic cannot be directly classified. However, commercial
traffic classifiers today typically apply heuristic methods, using traffic pattern matching 
algorithms to be able to identify the traffic. As an example, classifier products are able to 
identify popular VoIP services using heuristic methods although the traffic is encrypted and
mostly peer-to-peer.</t>

</section>
</section>

<section anchor="hint" title="Providing hints to and from the network">
<t>The following protocols aim to support a secure and privacy-aware dialogue between client, server and a network middlebox. These hints can allow information item exchange between the endpoints and the network, to assist queuing mechanisms and traffic pacing that accounts for network congestion and variable connection strength. These relate to the cooperative path to endpoint signalling as discussed at the IAB SEMI workshop <xref target="SEMI"/>, with the network following a more clearly-defined role in encrypted traffic delivery. </t>


<section anchor="dscp" title="DiffServ Code Points (DSCP)">

<t>Data packets are flagged with a traffic class (class of service). Network
operators may honour a DiffServ classification entering their network, or may choose to
override it (since it is potentially open to abuse by a service provider that classifies all its
content as high priority). The purpose is to help manage traffic and congestion in the
network.</t>

<t>Limitations:  This requires the content provider to flag data packets. This is extra work for
the provider, and it has potential for abuse if a content provider simply flags all packets with
high priorities. The network would need to know which flags to trust and which to override.
The use of DiffServ within the operator network is beneficial where the operator determines
the class of service itself; but where content is encrypted then heuristics would be needed to
predict the traffic type entering the network.
HTTP/2 allows several streams to be multiplexed over a single TCP connection. This means
that if a provider decides to send Web pages, videos, chat etc. as individual streams over
the same connection, then DiffServ would be useless as it would apply to the TCP/IP
connection as a whole. However it may be more efficient for such Web providers to serve
each content type from separate, dedicated servers – this will become clearer as HTTP/2
deployments are tuned for optimal delivery.</t>

</section>
<section anchor="ecs" title="Explicit Congestion Notification">
<t>Explicit Congestion Notification (ECN) routers can exchange congestion
notification headers to ECN compliant endpoints. This is in preference to inferring congestion
from dropped packets (e.g. in TCP). The purpose is to help manage traffic and congestion in
the network.</t>

<t>This solution is required to be implemented at network and service provider. The
service provider will utilise the ECN to reduce throughput until it is notified that congestion
has eased.</t>

<t>Limitation: As with DiffServ, operators may not trust an external entity to mark packets in a
fair/consistent manner.</t>

</section>
<section anchor="mpls" title="Multi Protocol Label Switching">

<t>Description: on entering an MPLS-compliant network, IP packets are flagged with a
’Forward Equivalence Class’ (FEC). This allows the network to make packet-forwarding
decisions according to their latency requirements. MPLS routers within the network parse
and act upon the FEC value. The FEC is set according to the source IP address and port.
The purpose is to help managing traffic and congestion in the network. This requires deployment of an MPLS ‘backbone’ with label-aware switches/ routers.</t>

<t>Limitations: an up-to-date correspondence table between Websites and server IP address must be created. Then, the category(s) of traffic have to be consistently mapped to a set of 
MPLS labels ,which entails a significant effort to setup and maintain.</t>

<t>Note: MPLS can specify how OSI Layer 3 (IP layer) traffic can be routed over Layer 2 (Data Link);
DiffServ only operates over Layer 3. DiffServ is potentially a less complex integration as it is
applied at the network edge servers only.</t>

</section>


<section anchor="spud" title="Substrate Protocol for User Datagrams (SPUD)">

<t>SPUD <xref target="SPUD"/> allows network devices on the path between endpoints to participate explicitly in a ‘tube’ of grouped UDP packets. The network involvement is outside of the end-to-end context, to minimise any privacy or security breach. The initial prototype is based on UDP packets but will investigate the support of additional transport layers (such as TCP).</t>

</section>
<section anchor="mtg" title="Mobile throughput Guidance">

<t>Mobile Throughput Guidance In-band Signalling <xref target="MTG"/> allows the network to inform the server endpoint as to what bandwidth the TCP connection can reasonably expect. This allows the server to adapt their throughput pacing based on dynamic network conditions, which can assist mechanisms such as Adaptive Bitrate Streaming and TCP congestion control.</t>

</section>

<section anchor="pcp" title="Port Control Protocol Flowdata options">

<t>PCP Flowdata options <xref target="PCPFD"/> defines a mechanism for a host to signal flow
   characteristics to the network, and the network to signal its ability
   to accommodate that flow back to the host. This allows certain network flows can to    receive service that is differentiated from other network flows, and may be used to establish flow priority before connection establishment. PCP Flowdata operates at IPv4 /IPv6 level.</t>

</section>

<section anchor="ip6" title="IPv6 Flow label">

<t>IPv6 includes a flow label header field. <xref target="RFC6438"/> details how this may be used to identify flows for load balancing and multipath routing, which may be of particular use for application-layer encrypted traffic. The flow label field is part of  the main header, which means it is not subject to the disadvantages of extension headers (namely their risk of being dropped by intermediary routers). The flow label may also be exposed as part of the outer IP packet in an IP tunnel, thus providing network flow information without compromising the payload.</t>

</section>

<section anchor="discuss" title="DISCUSS">

<t>Differentiated prIorities and Status Code-points Using Stun Signalling <xref target="DISCUSS"/> describes a mechanism for information exchange between an application and the network, viable only for UDP. As such it can be considered in the same bracket as SPUD</t>
</section>

</section><!-- end hints section-->
<section anchor="ack" title="Acknowledgements">

<t>The editor would like to thank the GSMA Web Working Group for their contributions, in particular to the technical solutions and network management functions, as well as contributions via the SAAG mailing list (Panos Kampanakis, Brian Carpenter) </t>

</section>
<section anchor="iana" title="IANA Considerations">

<t>There are no IANA consideraions.</t>

</section>
<section anchor="sec" title="Security Considerations">

<t>The intention of this document is to consider how to persist network management of encrypted traffic, without breaching user privacy or end-to-end security. In particular this document does not recommend any approach that intercepts or modifies client-server Transport Layer Security.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference anchor='RFC7258'>

<front>
<title>Pervasive Monitoring Is an Attack</title>
<author initials='S.' surname='Farrell' fullname='S. Farrell'>
<organization /></author>
<author initials='H.' surname='Tschofenig' fullname='H. Tschofenig'>
<organization /></author>
<date year='2014' month='May' />
<abstract>
<t>Pervasive monitoring is a technical attack that should be mitigated in the design of IETF protocols, where possible.</t></abstract></front>

<seriesInfo name='BCP' value='188' />
<seriesInfo name='RFC' value='7258' />
<format type='TXT' octets='13396' target='http://www.rfc-editor.org/rfc/rfc7258.txt' />
</reference>



<reference anchor='RFC2818'>

<front>
<title>HTTP Over TLS</title>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'>
<organization /></author>
<date year='2000' month='May' />
<abstract>
<t>This memo describes how to use Transport Layer Security (TLS) to secure Hypertext Transfer Protocol (HTTP) connections over the Internet.  This memo provides information for the Internet community.</t></abstract></front>

<seriesInfo name='RFC' value='2818' />
<format type='TXT' octets='15170' target='http://www.rfc-editor.org/rfc/rfc2818.txt' />
</reference>



<reference anchor='RFC5246'>

<front>
<title>The Transport Layer Security (TLS) Protocol Version 1.2</title>
<author initials='T.' surname='Dierks' fullname='T. Dierks'>
<organization /></author>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'>
<organization /></author>
<date year='2008' month='August' />
<abstract>
<t>This document specifies Version 1.2 of the Transport Layer Security (TLS) protocol.  The TLS protocol provides communications security over the Internet.  The protocol allows client/server applications to communicate in a way that is designed to prevent eavesdropping, tampering, or message forgery. [STANDARDS-TRACK]</t></abstract></front>

<seriesInfo name='RFC' value='5246' />
<format type='TXT' octets='222395' target='http://www.rfc-editor.org/rfc/rfc5246.txt' />
</reference>



<reference anchor='RFC4301'>

<front>
<title>Security Architecture for the Internet Protocol</title>
<author initials='S.' surname='Kent' fullname='S. Kent'>
<organization /></author>
<author initials='K.' surname='Seo' fullname='K. Seo'>
<organization /></author>
<date year='2005' month='December' />
<abstract>
<t>This document describes an updated version of the "Security Architecture for IP", which is designed to provide security services for traffic at the IP layer.  This document obsoletes RFC 2401 (November 1998). [STANDARDS-TRACK]</t></abstract></front>

<seriesInfo name='RFC' value='4301' />
<format type='TXT' octets='262123' target='http://www.rfc-editor.org/rfc/rfc4301.txt' />
</reference>

<reference anchor='RFC6438'>

<front>
<title>Using the IPv6 Flow Label for Equal Cost Multipath Routing and Link Aggregation in Tunnels</title>
<author initials='B.' surname='Carpenter' fullname='B. Carpenter'>
<organization/></author>
<author initials='S.' surname='Amante' fullname='S. Amante'>
<organization /></author>
<date year='2011' />
<abstract>
<t>The IPv6 flow label has certain restrictions on its use.  This
   document describes how those restrictions apply when using the flow
   label for load balancing by equal cost multipath routing and for link
   aggregation, particularly for IP-in-IPv6 tunneled traffic.</t></abstract></front>

<seriesInfo name='RFC' value='6438' />
<format type='HTML' target='https://tools.ietf.org/html/rfc6438' />
</reference>




    </references>

    <references title='Informative References'>

<reference anchor="IAB" target="https://www.iab.org/2014/11/14/iab-statement-on-internet-confidentiality/">
  <front>
    <title>IAB statement on Internet confidentiality</title>
    <author fullname="Internet Architecture Board">
      <organization>IAB</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="mm-effect-encrypt" target="https://datatracker.ietf.org/doc/draft-mm-wg-effect-encrypt/">
  <front>
    <title>Effect of Ubiquitous Encryption</title>
    <author fullname="K. Moriarty, A. Morton">
      <organization>IETF</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="MTG" target="https://tools.ietf.org/html/draft-flinck-mobile-throughput-guidance-02">
  <front>
    <title>Mobile Throughput Guidance Inband Signaling Protocol</title>
    <author fullname="H. Flinck et al.">
      <organization>IETF</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="SEMI" target="https://www.iab.org/activities/workshops/semi/">
  <front>
    <title>IAB workshop, 'Stack Evolution in a Middlebox Internet'</title>
    <author >
      <organization>IAB</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="SPUD" target="https://tools.ietf.org/html/draft-hildebrand-spud-prototype-03">
  <front>
    <title>Substrate Protocol for User Datagrams</title>
    <author fullname="J. Hildebrand, B. Trammell">
      <organization>IETF</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="TAG" target="https://w3ctag.github.io/web-https/">
  <front>
    <title>Securing the Web</title>
    <author fullname="W3C TAG">
      <organization>W3C</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="TCPINC" target="https://datatracker.ietf.org/wg/tcpinc/charter/">
  <front>
    <title>TCP Increased Security</title>
    <author fullname="tcpinc WG">
      <organization>IETF</organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="PCPFD" target="https://tools.ietf.org/html/draft-wing-pcp-flowdata-00">
  <front>
    <title>PCP Flowdata option</title>
    <author fullname="D. Wing">
      <organization>Cisco</organization>
    </author>
    <date year="2013"/>
  </front>
</reference>
<reference anchor="DISCUSS" target="https://tools.ietf.org/html/draft-martinsen-tram-discuss-02">
  <front>
    <title>Differentiated prIorities and Status Code-points Using Stun Signalling</title>
    <author fullname="P. Martinsen">
      <organization>Cisco</organization>
    </author>
    <date year="2015"/>
  </front>
</reference>


    </references>



  </back>
</rfc>

